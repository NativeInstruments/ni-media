language: cpp
  
git:
  depth: 3
  lfs_skip_smudge: true
   
matrix:
  include:
    - os: osx
      env: CONFIG=Release
      osx_image: xcode7.3
      compiler: clang
      
    - os: linux
      env: CONFIG=Release
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - g++-5
          - cmake
          - flac
          - libvorbis-dev
          - libogg
      
      
before_install:
  - |
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      brew update && brew install git-lfs libogg libvorbis flac
    fi
  - mkdir gtest;
  - cd gtest;
  - wget https://github.com/google/googletest/archive/release-1.8.0.tar.gz;
  - tar -xzvf release-1.8.0.tar.gz;
  - cd googletest-release-1.8.0;
  - mkdir build;
  - cd build;
  - cmake .. -G"Unix Makefiles" -DCMAKE_BUILD_TYPE=Release;
  - cmake --build .;
  - cp -r ../googletest/include/gtest /usr/local/include;
  - cp googlemock/gtest/lib*.a /usr/local/lib;
  - cd $TRAVIS_BUILD_DIR;

before_script:
  - mkdir build
  - cd build
  - |
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      cmake .. -DCMAKE_BUILD_TYPE=$CONFIG
    elif [ "$TRAVIS_OS_NAME" = "linux" ]; then
      cmake .. -DCMAKE_BUILD_TYPE=$CONFIG
    fi
    
script:
  - cmake --build . 
  - git lfs pull
  - cmake --build . --target test
